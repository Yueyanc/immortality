{"version":3,"sources":["../index.ts"],"sourcesContent":["import xml2js, { ParserOptions } from \"xml2js\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport {\n  TagTree,\n  TagType,\n  transformXMLObjectToTree,\n  treeToList,\n} from \"./packages/shared/utils/index\";\nimport _ from \"lodash\";\nconst root = process.cwd();\nconst valueMap: Record<string, any> = {};\n\n// 收集可能的value值\nfunction collectValue(value: string, name: string, filePath: string) {\n  const arr = valueMap[name];\n  if (arr) {\n    arr.push({ value, path: path.relative(root, filePath) });\n  } else {\n    valueMap[name] = [{ value, path: path.relative(root, filePath) }];\n  }\n}\n// 解析path的xml文件为obj\nasync function parseXmlByPath(filePath: string, options?: ParserOptions) {\n  const content = fs.readFileSync(filePath);\n  const parser = new xml2js.Parser(options);\n  return await parser.parseStringPromise(content);\n}\n\n// 查找所有xml文件\nfunction findXmlFiles(folderPath: string) {\n  const files = fs.readdirSync(folderPath);\n  let xmlFilesPatch: string[] = [];\n\n  files.forEach((file) => {\n    const filePath = path.join(folderPath, file);\n    const stat = fs.statSync(filePath);\n\n    if (stat.isDirectory()) {\n      // 如果是文件夹，则递归调用 findXmlFilesh 函数\n      xmlFilesPatch = xmlFilesPatch.concat(findXmlFiles(filePath));\n    } else if (path.extname(file) === \".xml\") {\n      // 如果是 .xml 文件，则将其添加到结果数组中\n      xmlFilesPatch.push(filePath);\n    }\n  });\n  return xmlFilesPatch;\n}\n\nasync function main() {\n  const pathList = findXmlFiles(path.join(root, \"./packages/Core/Defs\"));\n  const parsed = [];\n  for (const filePath of pathList) {\n    const obj = await parseXmlByPath(filePath, {\n      valueProcessors: [\n        (value, name) => {\n          collectValue(value, name, filePath);\n        },\n      ],\n    });\n    parsed.push({ parseResult: obj, filePath });\n  }\n  _.each(valueMap, (value, key) => {\n    valueMap[key] = _.unionBy(value, \"value\");\n  });\n  fs.writeFileSync(\n    path.join(root, \"./valueMap.js\"),\n    `export default \\n${JSON.stringify(valueMap)}\\n`\n  );\n  // console.dir(valueMap, { depth: null });\n}\nmain();\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,YAA+B;AACtC,OAAO,UAAU;AACjB,OAAO,QAAQ;AAOf,OAAO,OAAO;AACd,IAAM,OAAO,QAAQ,IAAI;AACzB,IAAM,WAAgC,CAAC;AAGvC,SAAS,aAAa,OAAe,MAAc,UAAkB;AACnE,QAAM,MAAM,SAAS,IAAI;AACzB,MAAI,KAAK;AACP,QAAI,KAAK,EAAE,OAAO,MAAM,KAAK,SAAS,MAAM,QAAQ,EAAE,CAAC;AAAA,EACzD,OAAO;AACL,aAAS,IAAI,IAAI,CAAC,EAAE,OAAO,MAAM,KAAK,SAAS,MAAM,QAAQ,EAAE,CAAC;AAAA,EAClE;AACF;AAEA,SAAe,eAAe,UAAkB,SAAyB;AAAA;AACvE,UAAM,UAAU,GAAG,aAAa,QAAQ;AACxC,UAAM,SAAS,IAAI,OAAO,OAAO,OAAO;AACxC,WAAO,MAAM,OAAO,mBAAmB,OAAO;AAAA,EAChD;AAAA;AAGA,SAAS,aAAa,YAAoB;AACxC,QAAM,QAAQ,GAAG,YAAY,UAAU;AACvC,MAAI,gBAA0B,CAAC;AAE/B,QAAM,QAAQ,CAAC,SAAS;AACtB,UAAM,WAAW,KAAK,KAAK,YAAY,IAAI;AAC3C,UAAM,OAAO,GAAG,SAAS,QAAQ;AAEjC,QAAI,KAAK,YAAY,GAAG;AAEtB,sBAAgB,cAAc,OAAO,aAAa,QAAQ,CAAC;AAAA,IAC7D,WAAW,KAAK,QAAQ,IAAI,MAAM,QAAQ;AAExC,oBAAc,KAAK,QAAQ;AAAA,IAC7B;AAAA,EACF,CAAC;AACD,SAAO;AACT;AAEA,SAAe,OAAO;AAAA;AACpB,UAAM,WAAW,aAAa,KAAK,KAAK,MAAM,sBAAsB,CAAC;AACrE,UAAM,SAAS,CAAC;AAChB,eAAW,YAAY,UAAU;AAC/B,YAAM,MAAM,MAAM,eAAe,UAAU;AAAA,QACzC,iBAAiB;AAAA,UACf,CAAC,OAAO,SAAS;AACf,yBAAa,OAAO,MAAM,QAAQ;AAAA,UACpC;AAAA,QACF;AAAA,MACF,CAAC;AACD,aAAO,KAAK,EAAE,aAAa,KAAK,SAAS,CAAC;AAAA,IAC5C;AACA,MAAE,KAAK,UAAU,CAAC,OAAO,QAAQ;AAC/B,eAAS,GAAG,IAAI,EAAE,QAAQ,OAAO,OAAO;AAAA,IAC1C,CAAC;AACD,OAAG;AAAA,MACD,KAAK,KAAK,MAAM,eAAe;AAAA,MAC/B;AAAA,EAAoB,KAAK,UAAU,QAAQ,CAAC;AAAA;AAAA,IAC9C;AAAA,EAEF;AAAA;AACA,KAAK;","names":[]}